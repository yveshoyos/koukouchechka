<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Layout without menu and footer -->
    <template id="layout" inherit_id="website.layout" name="Event seating layout" primary="True">
        <xpath expr="//div[@id='wrapwrap']/header" position="replace"/>
        <xpath expr="//div[@id='wrapwrap']/footer" position="replace"/>
        <xpath expr="//t[@t-call-assets='website.assets_editor'][@t-css='false']" position="after">
            <link rel="stylesheet" href="/event_seating/static/lib/seat-charts/jquery.seat-charts.css"/>
            <link rel="stylesheet" href="/event_seating/static/src/css/seating.css"/>
            <script src="/event_seating/static/lib/seat-charts/jquery.seat-charts.js"/>
            <script src="/event_seating/static/src/js/seating.js"/>
            <t t-raw='theater.get_css_seats_colors()'/>
        </xpath>
    </template>

    <template id="go_to_backend" name="Event seating go to backend">
        <div class="alert alert-info">
            <div class="container">
                <div class="text-center">
                    You can go back to backend by using following link.
                    <a t-attf-href="/web#return_label=Website&amp;model=#{model}&amp;id=#{res_id}&amp;view_type=form&amp;action=#{website.env.ref(action).id}">
                        <i class="fa fa-arrow-right"/> Back to edit mode
                    </a>
                </div>
            </div>
        </div>
    </template>

    <template id="seat_map" name="Event seating map">
        <div class="row">
            <div class="col-xs-12">
                <div id="seat-map">
                    <div class="front-indicator">Front</div>
                </div>
            </div>
        </div>
    </template>

    <!-- Page preview -->
    <template id="preview" name="Theater preview">
        <t t-call="event_seating.layout">
            <div id="wrap">
                <t t-call="event_seating.go_to_backend">
                    <t t-set="model" t-value="'event.theater'"/>
                    <t t-set="res_id" t-value="theater.id"/>
                    <t t-set="action" t-value="'event_seating.event_theater_action'"/>
                </t>
                <div class="oe_structure"/>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <h1 t-field="theater.name"/>
                        </div>
                    </div>
                    <t t-call="event_seating.seat_map"/>
                    <div class="row">
                        <div class="col-xs-12">
                            <h2>Legend</h2>
                            <div id="legend"/>
                        </div>
                    </div>
                </div>
                <script>
                    $(document).ready(function() {
                        map = <t t-raw="theater.get_json_disposition()"/>;
                        seats = <t t-raw="theater.get_json_seats()"/>;
                        legend = <t t-raw="theater.get_json_legend_items()"/>;
                        rows = <t t-raw="theater.get_rows()"/>;
                        load_seating_chart();
                    });
                </script>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>


    <!-- Page seat selection -->
    <template id="seat_selection" name="Seat selection">
        <t t-set="theater" t-value="event.theater_id"/>
        <t t-call="event_seating.layout">
            <div id="wrap">
                <t t-call="event_seating.go_to_backend">
                    <t t-set="model" t-value="'event.event'"/>
                    <t t-set="res_id" t-value="theater.id"/>
                    <t t-set="action" t-value="'event.action_event_view'"/>
                </t>
                <div class="oe_structure"/>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <h1>Seat selection for event "<t t-esc="event.name"/>"</h1>
                        </div>
                    </div>
                    <div class="row" t-if="not theater">
                        <div class="col-xs-12">
                            <p>You must select a theater in the event to use this function.</p>
                        </div>
                    </div>
                    <t t-call="event_seating.seat_map"/>
                    <div class="row" t-if="theater">
                        <div class="col-xs-12 col-lg-2">
                            <h2>Legend</h2>
                            <div id="legend"/>
                        </div>
                        <div class="col-xs-12 col-lg-6">
                            <h2>Attendees</h2>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Date</th>
                                        <th>Seated</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="event.registration_ids" t-as="registration">
                                        <tr>
                                            <td t-esc="registration.name"/>
                                            <td t-esc="registration.date_open" t-options="{'widget': 'datetime'}"/>
                                            <td>
                                                <span t-esc="registration.seats_count"/> / <span t-esc="registration.qty"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-xs-12 col-lg-4">
                            <h2>Seats (<span id="seats_counter">0</span>) <a href="#" class="btn-xs unselect_all_seats">[remove all]</a></h2>
                            <div id="selected_seats"/>
                            <div id="selected_grouped_seats"/>
                        </div>
                    </div>
                    <script t-if="theater">
                        $(document).ready(function() {
                            registrations = <t t-raw="event.get_registrations_json()"/>;
                            map = <t t-raw="theater.get_json_disposition()"/>;
                            seats = <t t-raw="theater.get_json_seats()"/>;
                            legend = <t t-raw="theater.get_json_legend_items()"/>;
                            rows = <t t-raw="theater.get_rows()"/>;
                            load_seating_chart('#seats_counter', '#selected_seats', '#selected_grouped_seats');
                        });
                    </script>
                </div>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

</odoo>
