<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Layout without menu and footer -->
    <template id="layout" inherit_id="website.layout" name="Forum Layout" primary="True">
        <xpath expr="//div[@id='wrapwrap']/header" position="replace"/>
        <xpath expr="//div[@id='wrapwrap']/footer" position="replace"/>
    </template>

    <!-- Page preview -->
    <template id="preview" name="Theater preview">
        <t t-call="event_seating.layout">
            <t t-set="head">
                <t t-raw='head'/>
                <link rel="stylesheet" href="/event_seating/static/lib/seat-charts/jquery.seat-charts.css"/>
                <link rel="stylesheet" href="/event_seating/static/src/css/seating.css"/>
                <script src="/event_seating/static/lib/seat-charts/jquery.seat-charts.js"/>
                <t t-raw='theater.get_css_seats_colors()'/>
            </t>
            <div id="wrap">
                <div class="alert alert-info">
                    <div class="container">
                        <div class="text-center">
                            You can go back to backend by using following link.
                            <a t-attf-href="/web#return_label=Website&amp;model=event.theater&amp;id=#{theater.id}&amp;view_type=form&amp;action=#{theater.env.ref('event_seating.event_theater_action').id}">
                                <i class="fa fa-arrow-right"/> Back to edit mode
                            </a>
                        </div>
                    </div>
                </div>
                <div class="oe_structure"/>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <h1 t-field="theater.name"/>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <div id="seat-map">
                                <div class="front-indicator">Front</div>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-xs-12">
                            <h2>Legend</h2>
                            <div id="legend"/>
                        </div>
                    </div>
                </div>
                <script>
                    $(document).ready(function() {
                        var seat_num = 1;
                        var sc = $('#seat-map').seatCharts({
                            map: <t t-raw="theater.get_json_disposition()"/>,
                            seats: <t t-raw="theater.get_json_seats()"/>,
                            legend: {
                                node : $('#legend'),
                                items : <t t-raw="theater.get_json_legend_items()"/>
                            },
                            naming: {
                                top : false,
                                left: true,
                                rows: <t t-raw="theater.get_rows()"/>,
                                getId: function(character, row, column) {
                                    return row + '-' + seat_num;
                                },
                                getLabel : function (character, row, column) {
                                    return row + '-' + seat_num++;
                                }
                            }
                        });
                    });
                </script>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>


    <!-- Page seat selection -->
    <template id="seat_selection" name="Seat selection">
        <t t-call="event_seating.layout">
            <t t-set="theater" t-value="event.theater_id"/>
            <t t-set="head">
                <t t-raw='head'/>
                <link rel="stylesheet" href="/event_seating/static/lib/seat-charts/jquery.seat-charts.css"/>
                <link rel="stylesheet" href="/event_seating/static/src/css/seating.css"/>
                <script src="/event_seating/static/lib/seat-charts/jquery.seat-charts.js"/>
                <t t-raw='theater.get_css_seats_colors()'/>
            </t>
            <div id="wrap">
                <div class="alert alert-info">
                    <div class="container">
                        <div class="text-center">
                            You can go back to backend by using following link.
                            <a t-attf-href="/web#return_label=Website&amp;model=event.event&amp;id=#{theater.id}&amp;view_type=form&amp;action=#{theater.env.ref('event.action_event_view').id}">
                                <i class="fa fa-arrow-right"/> Back to edit mode
                            </a>
                        </div>
                    </div>
                </div>
                <div class="oe_structure"/>
                <div class="container">
                    <div class="row">
                        <div class="col-xs-12">
                            <h1>Seat selection for event "<t t-esc="event.name"/>"</h1>
                        </div>
                    </div>
                    <div class="row" t-if="not theater">
                        <div class="col-xs-12">
                            <p>You must select a theater in the event to use this function.</p>
                        </div>
                    </div>
                    <div class="row" t-if="theater">
                        <div class="col-xs-12">
                            <div id="seat-map">
                                <div class="front-indicator">Front</div>
                            </div>
                        </div>
                    </div>
                    <div class="row" t-if="theater">
                        <div class="col-xs-12 col-lg-2">
                            <h2>Legend</h2>
                            <div id="legend"/>
                        </div>
                        <div class="col-xs-12 col-lg-6">
                            <h2>Attendees</h2>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Date</th>
                                        <th>Seated</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="event.registration_ids" t-as="registration">
                                        <tr>
                                            <td t-esc="registration.name"/>
                                            <td t-esc="registration.date_open" t-options="{'widget': 'datetime'}"/>
                                            <td>
                                                <span t-esc="registration.seats_count"/> / <span t-esc="registration.qty"/>
                                            </td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                        <div class="col-xs-12 col-lg-4">
                            <h2>Seats</h2>
                        </div>
                    </div>
                    <script t-if="theater">
                        $(document).ready(function() {
                            var seat_num = 1;
                            var sc = $('#seat-map').seatCharts({
                                map: <t t-raw="theater.get_json_disposition()"/>,
                                seats: <t t-raw="theater.get_json_seats()"/>,
                                legend : {
                                    node : $('#legend'),
                                    items : <t t-raw="theater.get_json_legend_items()"/>
                                },
                                naming : {
                                    top : false,
                                    left: true,
                                    rows: <t t-raw="theater.get_rows()"/>,
                                    getId: function(character, row, column) {
                                        return row + '-' + seat_num;
                                    },
                                    getLabel : function (character, row, column) {
                                        return row + '-' + seat_num++;
                                    }
                                },
                                click: function () {
                                    console.log(this.status());
                                    console.log(this.data());
                                    console.log(this.settings);
                                    console.log(sc.find('selected'));

                                    if (this.status() == 'available') {
                                        return 'selected';
                                    }
                                    else if (this.status() == 'selected') {
                                        return 'available';
                                    }
                                    else if (this.status() == 'unavailable') {
                                        return 'unavailable';
                                    }
                                    else {
                                        return this.style();
                                    }
                                }
                            });
                        });
                    </script>
                </div>
                <div class="oe_structure"/>
            </div>
        </t>
    </template>

</odoo>
